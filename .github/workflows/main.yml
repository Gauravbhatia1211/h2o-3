name: S3 Bucket Scanner

on:
  schedule:
    - cron: '0 0 * * *' # Runs daily at midnight UTC
  workflow_dispatch:
    inputs:
      org_name:
        description: 'Organization name to scan'
        required: true
        default: 'h2oai'  # You can change the default to any organization you'd like

jobs:
  scan_s3_buckets:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3
      with:
        fetch-depth: 0 # Ensure full history for all repositories

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests PyGithub

    - name: Debug - Print Working Directory
      run: pwd

    - name: Debug - List Files in Working Directory
      run: ls -al

    - name: Run S3 Scanner
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      run: |
        echo "Organization: ${{ github.event.inputs.org_name }}"
        python scan_s3_buckets.py "${{ github.event.inputs.org_name }}"  
